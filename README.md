# ByteFarm

用 **Python 编写程序** 控制游戏中的角色，采集资源，不断升级！

## 存档系统

- 每个存档是一个**独立文件夹** `saves/save_1/`、`saves/save_2/` ...
- 每个存档文件夹包含：
  - `state.json` - 游戏状态
  - `main.py` - 玩家主程序（入口）
  - 玩家可在此目录添加其他 `.py` 文件，在 `main.py` 中用 `import` 引入
- 支持 10 个存档槽位
- 主菜单可选择「新游戏」或加载已有存档
- 游戏中 **F5** 快速保存，**F9** 读档

## 快速开始

```bash
# 安装依赖
pip install -r requirements.txt

# 运行游戏
python main.py
```

## 如何游玩

1. 启动游戏后进入主菜单，可选择「新游戏」或「加载存档」
2. 游戏内置**代码编辑器**（右侧面板），在此编写 Python 程序
3. **F2** 开始执行：运行当前编辑器中的代码，机器人开始按你的程序行动
4. **F3** 停止执行：停止程序，机器人不再行动
5. **E** 切换编辑器显示/隐藏
6. **F5** 保存到当前槽位，**F9** 读档
7. 按 **ESC** 退出

## 内置编辑器

- 编辑器默认显示在右侧，可**拖动**标题栏移动位置
- **滚轮**：在代码区域滚动
- **代码高亮**：Python 语法高亮（关键字、字符串、注释等）
- **调整大小**：拖动右下角三角手柄
- **最小化/展开**：点击标题栏右侧 **−** / **展开** 按钮
- **开始执行** 或 **F2**：运行当前代码
- **停止执行** 或 **F3**：停止运行
- **E**：显示/隐藏编辑器

## 游戏机制

- **地图**：20×15 格子的随机地图，有草地、森林（产木材）、矿脉（产矿石）
- **采集**：站在有资源的格子上执行 `Action.COLLECT` 即可采集
- **升级树**：按 **U** 打开树状升级界面，消耗资源购买节点可提升采集速度、移动速度
- **升级方式**：脚本返回 `(Action.UPGRADE, "collect_1")` 等购买指定节点
- **实时运行**：游戏以 60 FPS 运行，每帧调用你的 `update()` 函数

## 玩家程序 API

定义 `run()`，无需 `import` 游戏模块，直接调用：

- `move(East)` / `West` / `North` / `South` 移动（坐标系：左下角(0,0)，x向右、y向上）
- `collect()` 采集当前格子 1 个资源
- `measure()` 返回当前格子剩余资源数量
- `upgrade("节点id")` 购买升级
- `get_purchasable()` 返回可购买升级的 id 列表
- `get_position()`、`get_nearby()` 获取位置和周围格子

每操作消耗时间，顺序执行。

### 程序示例

```python
def run():
    while True:
        if measure() > 0:
            collect()
        else:
            for nid in get_purchasable():
                upgrade(nid)
                break
            else:
                move(East)
```

详见 `player_strategy.py` 中的示例代码。
